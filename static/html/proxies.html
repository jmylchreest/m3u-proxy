<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Stream Proxies - M3U Proxy</title>
        <link rel="stylesheet" href="/static/css/main.css" />
    </head>
    <body>
        <div id="headerContainer"></div>

        <div class="container">
            <div id="navContainer"></div>

            <div id="alertsContainer"></div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Stream Proxies</h2>
                    <button id="addProxyBtn" class="btn btn-primary">
                        Create Proxy
                    </button>
                </div>

                <div
                    id="loadingIndicator"
                    class="text-center"
                    style="display: none"
                >
                    <span class="loading"></span> Loading proxies...
                </div>

                <div class="table-responsive">
                    <table id="proxiesTable" class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>ULID</th>
                                <th>Sources</th>
                                <th>Filters</th>
                                <th>Status</th>
                                <th>Last Generated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="proxiesTableBody">
                            <!-- Proxies will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Proxy Modal -->
        <div id="proxyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle" class="modal-title">
                        Create Stream Proxy
                    </h3>
                    <button id="closeModal" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="proxyForm">
                        <div class="form-group">
                            <label for="proxyName" class="form-label"
                                >Proxy Name *</label
                            >
                            <input
                                type="text"
                                id="proxyName"
                                class="form-control"
                                required
                            />
                            <small class="text-muted"
                                >A descriptive name for this proxy</small
                            >
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input
                                    type="checkbox"
                                    id="isActive"
                                    class="form-check-input"
                                    checked
                                />
                                <label for="isActive" class="form-label"
                                    >Active</label
                                >
                            </div>
                            <small class="text-muted"
                                >Inactive proxies won't generate M3U
                                files</small
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label">Select Sources</label>
                            <div id="sourcesSelection" class="mb-3">
                                <!-- Sources will be populated here -->
                            </div>
                            <small class="text-muted"
                                >Choose which stream sources to include in this
                                proxy</small
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label"
                                >Configure Filters (Optional)</label
                            >
                            <div id="filtersConfiguration">
                                <div id="selectedFilters" class="mb-3">
                                    <!-- Selected filters will appear here -->
                                </div>
                                <div class="d-flex">
                                    <select
                                        id="availableFilters"
                                        class="form-select"
                                    >
                                        <option value="">
                                            Select a filter to add...
                                        </option>
                                    </select>
                                    <button
                                        type="button"
                                        id="addFilterBtn"
                                        class="btn btn-outline-primary btn-sm"
                                        disabled
                                    >
                                        Add Filter
                                    </button>
                                </div>
                            </div>
                            <small class="text-muted"
                                >Filters are applied in order. Drag to
                                reorder.</small
                            >
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancelProxy" class="btn btn-secondary">
                        Cancel
                    </button>
                    <button id="saveProxy" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>

        <!-- Preview Modal -->
        <div id="previewModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Proxy Preview</h3>
                    <button
                        onclick="proxiesManager.hidePreviewModal()"
                        class="modal-close"
                    >
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <div id="previewContent">
                        <div class="mb-3">
                            <strong>M3U URL:</strong>
                            <div class="input-group">
                                <input
                                    type="text"
                                    id="proxyUrl"
                                    class="form-control"
                                    readonly
                                />
                                <button
                                    class="btn btn-outline-secondary"
                                    onclick="proxiesManager.copyUrl()"
                                >
                                    Copy
                                </button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <strong>Channel Preview:</strong>
                            <div
                                id="channelPreview"
                                class="table-responsive"
                                style="max-height: 400px; overflow-y: auto"
                            >
                                <!-- Channel preview will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                        onclick="proxiesManager.hidePreviewModal()"
                        class="btn btn-secondary"
                    >
                        Close
                    </button>
                    <button
                        onclick="proxiesManager.generateProxy()"
                        class="btn btn-primary"
                    >
                        Generate M3U
                    </button>
                </div>
            </div>
        </div>

        <script src="/static/js/shared-loader.js"></script>
        <script src="/static/js/proxies.js"></script>
    </body>
</html>
